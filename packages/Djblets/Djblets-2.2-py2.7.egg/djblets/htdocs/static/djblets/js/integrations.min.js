(function(){if(!window.Djblets){window.Djblets={}}"use strict";Djblets.AddIntegrationPopupView=Backbone.View.extend({className:"djblets-c-integrations-popup",integrationTemplateSource:'<li class="djblets-c-integration">\n <a href="<%- addURL %>">\n  <% if (iconSrc) { %>\n   <img class="djblets-c-integration__icon"\n        src="<%- iconSrc %>"\n        srcset="<%- iconSrcSet %>"\n        width="48" height="48" alt="">\n  <% } %>\n  <div class="djblets-c-integration__details">\n   <div class="djblets-c-integration__name"><%- name %></div>\n   <div class="djblets-c-integration__description">\n    <%- description %>\n   </div>\n  </div>\n </a>\n</li>',emptyIntegrationsTemplateSource:'<p class="djblets-c-integrations-popup__empty">\n '+_.escape(gettext("There are no integrations currently installed."))+"\n</p>",initialize:function initialize(options){this.integrations=options.integrations},render:function render(){var integrations=this.integrations;if(integrations.length>0){var itemTemplate=_.template(this.integrationTemplateSource);var $list=$("<ul>");for(var i=0;i<integrations.length;i++){$list.append(itemTemplate(integrations[i]))}this.$el.append($list)}else{this.$el.addClass("-is-empty").append(_.template(this.emptyIntegrationsTemplateSource)())}return this},remove:function remove(){this.hide();Backbone.View.prototype.remove.call(this)},show:function show($button){var _this=this;var $window=$(window);var $el=this.$el;var el=this.el;var buttonPos=$button.position();$el.move(buttonPos.left,buttonPos.top+$button.outerHeight(),"absolute").width(100).height(1).show();var popupBorderWidths=$el.getExtents("b","lr");var scrollbarWidth=el.offsetWidth-el.clientWidth-popupBorderWidths;var popupOffset=$el.offset();var popupHeight=Math.floor($window.height()-popupOffset.top-$el.getExtents("bm","tb"));$el.css({height:"auto","max-height":popupHeight});if($el.hasClass("-is-empty")){$el.css("width","auto")}else{var tileWidth=$el.find(".djblets-c-integration").filter(":first").outerWidth(true);var winWidth=$window.width();var availWidth=winWidth-popupOffset.left-scrollbarWidth-$el.getExtents("m","r");var popupWidth=Math.max(Math.floor(availWidth/tileWidth),1)*tileWidth+scrollbarWidth+popupBorderWidths;$el.outerWidth(popupWidth);var newScrollbarWidth=el.offsetWidth-el.clientWidth-popupBorderWidths;if(newScrollbarWidth===0){popupWidth-=scrollbarWidth;$el.outerWidth(popupWidth)}if(popupOffset.left+popupWidth>winWidth){$el.css("left",winWidth-popupWidth)}}$(document).one("click.djblets-integrations-popup",function(){return _this.hide()});$(window).one("resize.djblets-integrations-popup",function(){return _this.hide()})},hide:function hide(){this.$el.hide();$(document).off("click.djblets-integrations-popup");$(window).off("resize.djblets-integrations-popup")}});"use strict";(function(){var IntegrationConfigItem=Djblets.Config.ListItem.extend({defaults:_.defaults({removeLabel:gettext("Delete"),showRemove:true},Djblets.Config.ListItem.prototype.defaults),url:function url(){return this.get("editURL")},parse:function parse(data){return{editURL:data.editURL,id:data.id,integrationID:data.integrationID,itemState:data.enabled?"enabled":"disabled",name:data.name}}});var IntegrationConfigItemView=Djblets.Config.TableItemView.extend({className:"djblets-c-integration-config djblets-c-config-forms-list__item",actionHandlers:{delete:"_onDeleteClicked"},template:_.template('<td class="djblets-c-integration-config__name">\n <img src="<%- iconSrc %>"\n      srcset="<%- iconSrcSet %>"\n      width="32" height="32" alt="">\n <a href="<%- editURL %>"><%- name %></a>\n</td>\n<td class="djblets-c-integration-config__integration-name">\n <%- integrationName %>\n</td>\n<td class="djblets-c-config-forms-list__item-state"></td>\n<td></td>'),getRenderContext:function getRenderContext(){var integrationID=this.model.get("integrationID");var integration=this.model.collection.options.integrationsMap[integrationID];return{iconSrc:integration.iconSrc,iconSrcSet:integration.iconSrcSet,integrationName:integration.name}},_onDeleteClicked:function _onDeleteClicked(){var _this=this;$("<p>").text(gettext("This integration will be permanently removed. This cannot be undone.")).modalBox({title:gettext("Are you sure you want to delete this integration?"),buttons:[$("<button>").text(gettext("Cancel")),$('<button class="danger">').text(gettext("Delete Integration")).click(function(){return _this.model.destroy({beforeSend:function beforeSend(xhr){xhr.setRequestHeader("X-CSRFToken",_this.model.collection.options.csrfToken)}})})]})}});Djblets.IntegrationConfigListView=Backbone.View.extend({events:{"click .djblets-c-integration-configs__add":"_onAddIntegrationClicked"},addIntegrationPopupViewType:Djblets.AddIntegrationPopupView,listItemsCollectionType:Djblets.Config.ListItems,listItemType:IntegrationConfigItem,listViewType:Djblets.Config.TableView,listItemViewType:IntegrationConfigItemView,initialize:function initialize(options){this._integrationIDs=options.integrationIDs;this._integrationsMap=options.integrationsMap;this.list=new Djblets.Config.List({},{collection:new this.listItemsCollectionType(options.configs,{csrfToken:options.csrfToken,integrationsMap:options.integrationsMap,model:this.listItemType,parse:true})});this._popup=null},render:function render(){this.listView=new this.listViewType({el:this.$(".djblets-c-config-forms-list"),model:this.list,ItemView:this.listItemViewType});this.listView.render().$el.removeAttr("aria-busy");this._$listContainer=this.listView.$el.parent();this.listenTo(this.list.collection,"add remove",this._showOrHideConfigsList);this._showOrHideConfigsList();return this},_showOrHideConfigsList:function _showOrHideConfigsList(){if(this.list.collection.length>0){this._$listContainer.show()}else{this._$listContainer.hide()}},_onAddIntegrationClicked:function _onAddIntegrationClicked(e){e.preventDefault();e.stopPropagation();if(!this._popup){var integrationIDs=this._integrationIDs;var integrationsMap=this._integrationsMap;var integrations=[];for(var i=0;i<integrationIDs.length;i++){integrations.push(integrationsMap[integrationIDs[i]])}this._popup=new this.addIntegrationPopupViewType({integrations:integrations});this._popup.render().$el.appendTo(this.$el)}this._popup.show($(e.target))}})})()}).call(this);
