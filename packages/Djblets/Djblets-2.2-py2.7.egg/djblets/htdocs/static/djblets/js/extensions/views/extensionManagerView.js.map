{"version":3,"sources":["extensionManagerView.es6.js"],"names":[],"mappings":"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","file":"extensionManagerView.js","sourcesContent":["(function() {\n\n\n/**\n * An item in the list of registered extensions.\n *\n * This will contain information on the extension and actions for toggling\n * the enabled state, reloading the extension, or configuring the extension.\n */\nconst ExtensionItem = Djblets.Config.ListItem.extend({\n    defaults: _.defaults({\n        extension: null,\n    }, Djblets.Config.ListItem.prototype.defaults),\n\n    /**\n     * Initialize the item.\n     *\n     * This will set up the initial state and then listen for any changes\n     * to the extension's state (caused by enabling/disabling/reloading the\n     * extension).\n     */\n    initialize() {\n        Djblets.Config.ListItem.prototype.initialize.apply(this, arguments);\n\n        this._updateActions();\n        this._updateItemState();\n\n        this.listenTo(\n            this.get('extension'),\n            'change:loadable change:loadError change:enabled',\n            () => {\n                this._updateItemState();\n                this._updateActions();\n            });\n    },\n\n    /**\n     * Update the actions for the extension.\n     *\n     * If the extension is disabled, this will add an Enabled action.\n     *\n     * If it's enabled, but has a load error, it will add a Reload action.\n     *\n     * If it's enabled, it will provide actions for Configure and Database,\n     * if enabled by the extension, along with a Disable action.\n     */\n    _updateActions() {\n        const extension = this.get('extension');\n        const actions = [];\n\n        if (!extension.get('loadable')) {\n            /* Add an action for reloading the extension. */\n            actions.push({\n                id: 'reload',\n                label: _`Reload`,\n            });\n        } else if (extension.get('enabled')) {\n            /*\n             * Show all the actions for enabled extensions.\n             *\n             * Note that the order used is here to ensure visual alignment\n             * for most-frequently-used options.\n             */\n            const configURL = extension.get('configURL');\n            const dbURL = extension.get('dbURL');\n\n            if (dbURL) {\n                actions.push({\n                    id: 'database',\n                    label: _`Database`,\n                    url: dbURL,\n                });\n            }\n\n            if (configURL) {\n                actions.push({\n                    id: 'configure',\n                    label: _`Configure`,\n                    primary: true,\n                    url: configURL,\n                });\n            }\n\n            actions.push({\n                id: 'disable',\n                label: _`Disable`,\n                danger: true,\n            });\n        } else {\n            /* Add an action for enabling a disabled extension. */\n            actions.push({\n                id: 'enable',\n                label: _`Enable`,\n                primary: true,\n            });\n        }\n\n        this.setActions(actions);\n    },\n\n    /**\n     * Update the state of this item.\n     *\n     * This will set the \"error\", \"enabled\", or \"disabled\" state of the\n     * item, depending on the corresponding state in the extension.\n     */\n    _updateItemState() {\n        const extension = this.get('extension');\n        let itemState;\n\n        if (!extension.get('loadable')) {\n            itemState = 'error';\n        } else if (extension.get('enabled')) {\n            itemState = 'enabled';\n        } else {\n            itemState = 'disabled';\n        }\n\n        this.set('itemState', itemState);\n    },\n});\n\n\n/**\n * Displays an extension in the Manage Extensions list.\n *\n * This will show information about the extension, and provide links for\n * enabling/disabling the extension, and (depending on the extension's\n * capabilities) configuring it or viewing its database.\n */\nconst ExtensionItemView = Djblets.Config.TableItemView.extend({\n    className: 'djblets-c-extension-item djblets-c-config-forms-list__item',\n\n    actionHandlers: {\n        'disable': '_onDisableClicked',\n        'enable': '_onEnableClicked',\n        'reload': '_onReloadClicked',\n    },\n\n    template: _.template(dedent`\n        <td class=\"djblets-c-config-forms-list__item-main\">\n         <div class=\"djblets-c-extension-item__header\">\n          <h3 class=\"djblets-c-extension-item__name\"><%- name %></h3>\n          <span class=\"djblets-c-extension-item__version\"><%- version %></span>\n          <div class=\"djblets-c-extension-item__author\">\n           <% if (authorURL) { %>\n            <a href=\"<%- authorURL %>\"><%- author %></a>\n           <% } else { %>\n            <%- author %>\n           <% } %>\n          </div>\n         </div>\n         <p class=\"djblets-c-extension-item__description\">\n          <%- summary %>\n         </p>\n         <% if (!loadable) { %>\n          <pre class=\"djblets-c-extension-item__load-error\"><%- loadError %></pre>\n         <% } %>\n        </td>\n        <td class=\"djblets-c-config-forms-list__item-state\"></td>\n        <td></td>\n    `),\n\n    /**\n     * Return context data for rendering the item's template.\n     *\n     * Returns:\n     *     object:\n     *     Context data for the render.\n     */\n    getRenderContext() {\n        return this.model.get('extension').attributes;\n    },\n\n    /**\n     * Handle a click on the Disable action.\n     *\n     * This will make an asynchronous request to disable the extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the disable request. This will resolve once the\n     *     API has handled the request.\n     */\n    _onDisableClicked() {\n        return this.model.get('extension').disable()\n            .catch(error => {\n                alert(_`Failed to disable the extension: ${error.message}.`);\n            });\n    },\n\n    /**\n     * Handle a click on the Enable action.\n     *\n     * This will make an asynchronous request to enable the extension.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the enable request. This will resolve once the\n     *     API has handled the request.\n     */\n    _onEnableClicked() {\n        return this.model.get('extension').enable()\n            .catch(error => {\n                alert(_`Failed to enable the extension: ${error.message}.`);\n            });\n    },\n\n    /**\n     * Handle a click on the Reload action.\n     *\n     * This will trigger an event on the item that tells the extension\n     * manager to perform a full reload of all extensions, this one included.\n     *\n     * Returns:\n     *     Promise:\n     *     A promise for the enable request. This will never resolve, in\n     *     practice, but is returned to enable the action's spinner until\n     *     the page reloads.\n     */\n    _onReloadClicked() {\n        return new Promise(() => this.model.trigger('needsReload'));\n    },\n});\n\n\n/**\n * Displays the interface showing all installed extensions.\n *\n * This loads the list of installed extensions and displays each in a list.\n */\nDjblets.ExtensionManagerView = Backbone.View.extend({\n    events: {\n        'click .djblets-c-extensions__reload': '_reloadFull',\n    },\n\n    listItemsCollectionType: Djblets.Config.ListItems,\n    listItemType: ExtensionItem,\n    listItemViewType: ExtensionItemView,\n    listViewType: Djblets.Config.TableView,\n\n    /**\n     * Initialize the view.\n     */\n    initialize() {\n        this.list = new Djblets.Config.List(\n            {},\n            {\n                collection: new this.listItemsCollectionType(\n                    [],\n                    {\n                        model: this.listItemType,\n                    })\n            });\n    },\n\n    /**\n     * Render the view.\n     *\n     * Returns:\n     *     Djblets.ExtensionManagerView:\n     *     This object, for chaining.\n     */\n    render() {\n        const model = this.model;\n        const list = this.list;\n\n        this.listView = new this.listViewType({\n            el: this.$('.djblets-c-config-forms-list'),\n            model: list,\n            ItemView: this.listItemViewType,\n        });\n        this.listView.render().$el\n            .removeAttr('aria-busy')\n            .addClass('-all-items-are-multiline');\n\n        this._$listContainer = this.listView.$el.parent();\n\n        this.listenTo(model, 'loading', () => list.collection.reset());\n        this.listenTo(model, 'loaded', this._onLoaded);\n        model.load();\n\n        return this;\n    },\n\n    /**\n     * Handler for when the list of extensions is loaded.\n     *\n     * Renders each extension in the list. If the list is empty, this will\n     * display that there are no extensions installed.\n     */\n    _onLoaded() {\n        const items = this.list.collection;\n\n        this.model.installedExtensions.each(extension => {\n            const item = items.add({\n                extension: extension,\n            });\n\n            this.listenTo(item, 'needsReload', this._reloadFull);\n        });\n    },\n\n    /**\n     * Perform a full reload of the list of extensions on the server.\n     *\n     * This submits our form, which is set in the template to tell the\n     * ExtensionManager to do a full reload.\n     */\n    _reloadFull() {\n        this.el.submit();\n    },\n});\n\n\n})();\n"]}