{"version":3,"sources":["conditionSetModel.es6.js"],"names":[],"mappings":";;AAAA;;;;;;;;;;;;;;;;;;;;;;;AAuBA,QAAQ,KAAR,CAAc,YAAd,GAA6B,SAAS,KAAT,CAAe,MAAf,CAAsB;AAC/C,cAAU;AACN,mBAAW,IADL;AAEN,gBAAQ;AAFF,KADqC;;AAM/C;;;;;;;AAOA,cAb+C,sBAapC,UAboC,EAaxB;AAAA;;AACnB,aAAK,OAAL,GAAe,IAAI,SAAS,UAAb,CAAwB,WAAW,WAAnC,EAAgD;AAC3D,mBAAO,QAAQ,KAAR,CAAc,eADsC;AAE3D,mBAAO;AAFoD,SAAhD,CAAf;;AAKA,aAAK,UAAL,GAAkB,IAAI,SAAS,UAAb,CAAwB,WAAW,cAAnC,EAAmD;AACjE,mBAAO,eAAC,KAAD,EAAQ,OAAR,EAAoB;AACvB,oBAAM,SAAS,MAAM,MAAN,IACA,MAAK,OAAL,CAAa,GAAb,CAAiB,MAAM,QAAvB,CADf;AAEA,oBAAM,WAAW,MAAM,QAAN,KACC,SACE,OAAO,SAAP,CAAiB,GAAjB,CAAqB,MAAM,UAA3B,CADF,GAEE,IAHH,CAAjB;AAIA,oBAAM,SAAS,MAAK,GAAL,CAAS,QAAT,CAAf;AACA,oBAAM,cAAe,WAAW,IAAX,GAAkB,CAAlB,GAAsB,SAAS,CAApD;;AAEA,sBAAK,GAAL,CAAS,QAAT,EAAmB,WAAnB;;AAEA,uBAAO,IAAI,QAAQ,KAAR,CAAc,SAAlB,CACH;AACI,wBAAI,WADR;AAEI,4BAAQ,MAFZ;AAGI,8BAAU,QAHd;AAII,2BAAO,MAAM,KAJjB;AAKI,2BAAO,MAAM,KALjB;AAMI,2BAAO,MAAM;AANjB,iBADG,EASH,OATG,CAAP;AAUH;AAvBgE,SAAnD,CAAlB;AAyBH,KA5C8C;;;AA8C/C;;;;;;AAMA,mBApD+C,6BAoD7B;AACd,YAAM,SAAS,KAAK,OAAL,CAAa,KAAb,EAAf;;AAEA,aAAK,UAAL,CAAgB,GAAhB,CAAoB;AAChB,oBAAQ,MADQ;AAEhB,sBAAU,OAAO,SAAP,CAAiB,KAAjB;AAFM,SAApB;AAIH,KA3D8C;;;AA6D/C;;;;;;;;;;;;;;AAcA,SA3E+C,iBA2EzC,IA3EyC,EA2EnC;AACR,eAAO;AACH,uBAAW,KAAK;AADb,SAAP;AAGH;AA/E8C,CAAtB,CAA7B","file":"conditionSetModel.js","sourcesContent":["/**\n * A set of configured conditions, and available choices.\n *\n * This tracks all the conditions that are being configured, handling assigning\n * each one an ID and tracking their state. It also provides information on\n * each choice available for a condition.\n *\n * Attributes:\n *     choices (Backbone.Collection):\n *         A collection of possible choices for a condition. Each entry is a\n *         :js:class:`Djblets.Forms.ConditionChoice`.\n *\n *     conditions (Backbone.Collection):\n *         A collection of configured conditions. Each entry is a\n *         :js:class:`Djblets.Forms.Condition`.\n *\n * Model Attributes:\n *     fieldName (string):\n *         The name of the form field for the main conditions element.\n *\n *     lastID (number):\n *         The last condition row ID used.\n */\nDjblets.Forms.ConditionSet = Backbone.Model.extend({\n    defaults: {\n        fieldName: null,\n        lastID: null\n    },\n\n    /**\n     * Initialize the model.\n     *\n     * Args:\n     *     attributes (object):\n     *         Attribute values passed to the constructor.\n     */\n    initialize(attributes) {\n        this.choices = new Backbone.Collection(attributes.choicesData, {\n            model: Djblets.Forms.ConditionChoice,\n            parse: true\n        });\n\n        this.conditions = new Backbone.Collection(attributes.conditionsData, {\n            model: (attrs, options) => {\n                const choice = attrs.choice ||\n                               this.choices.get(attrs.choiceID);\n                const operator = attrs.operator ||\n                                 (choice\n                                  ? choice.operators.get(attrs.operatorID)\n                                  : null);\n                const lastID = this.get('lastID');\n                const conditionID = (lastID === null ? 0 : lastID + 1);\n\n                this.set('lastID', conditionID);\n\n                return new Djblets.Forms.Condition(\n                    {\n                        id: conditionID,\n                        choice: choice,\n                        operator: operator,\n                        value: attrs.value,\n                        valid: attrs.valid,\n                        error: attrs.error\n                    },\n                    options);\n            }\n        });\n    },\n\n    /**\n     * Add a new condition.\n     *\n     * This will construct a new condition with defaults and add it to the\n     * collection.\n     */\n    addNewCondition() {\n        const choice = this.choices.first();\n\n        this.conditions.add({\n            choice: choice,\n            operator: choice.operators.first()\n        });\n    },\n\n    /**\n     * Parse the attribute data passed to the model.\n     *\n     * This will extract only the ``fieldName`` attribute, leaving the rest\n     * to be specially handled by :js:func:`initialize`.\n     *\n     * Args:\n     *     data (object):\n     *         The attribute data passed to the model.\n     *\n     * Returns:\n     *     object:\n     *     The parsed attributes.\n     */\n    parse(data) {\n        return {\n            fieldName: data.fieldName\n        };\n    }\n});\n"]}