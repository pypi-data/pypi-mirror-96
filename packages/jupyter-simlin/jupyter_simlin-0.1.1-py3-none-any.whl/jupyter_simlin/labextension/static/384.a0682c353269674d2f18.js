(self.webpackChunkjupyter_simlin=self.webpackChunkjupyter_simlin||[]).push([[384],{85384:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MIME_TYPE:()=>v,default:()=>g,rendererFactory:()=>w});var n=i(75994),r=i(56271),s=i.n(r),a=i(53302),o=i(23461),d=i(97298),c=i(88771),l=i(52473),m=i(98080),h=i(64520),p=i(80629),y=i(52683);async function u(e="",t){const i=y.ServerConnection.makeSettings(),n=p.URLExt.join(i.baseUrl,"jupyter-simlin",e),r={};if(void 0!==t){r.body="string"==typeof t?t:JSON.stringify(t),r.method="POST";const e=new Headers;e.set("Content-Type","application/json"),r.headers=e}let s;try{s=await y.ServerConnection.makeRequest(n,r,i)}catch(e){throw new y.ServerConnection.NetworkError(e)}let a=await s.text();if(a.length>0)try{a=JSON.parse(a)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new y.ServerConnection.ResponseError(s,a.message||a);return a}class j extends h.ReactWidget{constructor(){super(),this.projectId="",this.isEditable=!1,this.handleSave=async(e,t)=>{const i={contents:(0,m.kZ)(e)};return await u("model/"+encodeURIComponent(this.projectId),i),t+1},this.mimeType="application/vnd.simlin.widget-view+json",this.addClass("mimerenderer-simlin_jupyter_widget")}async renderModel(e){const t=e.data[this.mimeType],i=t.project_id;this.projectId=i;let n=!1,r="";try{r=(await u("model/"+encodeURIComponent(i))).contents,n=!0}catch(e){}this.isEditable=!!t.project_is_editable,""===r&&(r=t.project_initial_source),i.endsWith(".mdl.simlin")&&!n?(r=await(0,l.convertMdlToXmile)((0,m.Gh)(r),!1),this.project=await(0,c.fromXmile)(r)):n||!i.endsWith(".stmx.simlin")&&!i.endsWith(".xmile.simlin")?this.project=(0,m._f)(r):this.project=await(0,c.fromXmile)((0,m.Gh)(r)),this.update();const s=(0,d.ri)(a.IK.deserializeBinary(this.project));try{const[t]=(0,o.renderSvgToString)(s,"main");e.data["image/svg+xml"]||setTimeout((()=>{e.setData({data:Object.assign({},e.data,{"image/svg+xml":t}),metadata:e.metadata})}))}catch(e){}}render(){if(!this.project)return s().createElement("div",null);const e=this.isEditable?{height:625}:void 0;return s().createElement("div",{style:e},s().createElement(o.Editor,{initialProjectBinary:(0,d.ri)(this.project),initialProjectVersion:1,name:"model",embedded:!this.isEditable,onSave:this.handleSave}))}}const v="application/vnd.simlin.widget-view+json",w={safe:!0,mimeTypes:[v],createRenderer:()=>new j},g={id:"jupyter-simlin:plugin",autoStart:!0,activate:(e,t)=>{t.addFactory(w,0)},requires:[n.IRenderMimeRegistry]}}}]);