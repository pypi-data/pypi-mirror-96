
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Base classes &#8212; Translate Toolkit 3.3.3 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bootstrap.js"></script>
    <script src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quoting and Escaping" href="quoting_and_escaping.html" />
    <link rel="prev" title="Standards conformance" href="conformance.html" /> 
  </head><body>
  <div id="navbar" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="brand" href="../index.html">Translate Toolkit</a>
        <span class="navbar-text pull-left"><b>3.3.3</b></span>
          <ul class="nav">
            <li class="divider-vertical"></li>
            
              <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html#tools">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commands/index.html#scripts">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Supported formats</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers/styleguide.html">Translate Styleguide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/styleguide.html#documentation">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/building.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/testing.html#command-line-functional-testing">Command Line Functional Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/developers.html">Translate Toolkit Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/releasing.html">Making a Translate Toolkit Release</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/deprecation.html">Deprecation of Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History of the Translate Toolkit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a></li>
</ul>
</ul>
</li>
              
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Base classes</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#the-classes">The classes</a><ul>
<li><a class="reference internal" href="#message-string-multistring">Message/string (multistring)</a></li>
<li><a class="reference internal" href="#translation-unit">Translation unit</a></li>
<li><a class="reference internal" href="#store">Store</a></li>
<li><a class="reference internal" href="#multifile">Multifile</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
</ul>
</ul>
</li>
            
            
              
  <li><a href="conformance.html"
         title="previous chapter">&laquo; Standards conformance</a></li>
  <li><a href="quoting_and_escaping.html"
         title="next chapter">Quoting and Escaping &raquo;</a></li>
            
          </ul>
          <ul class="nav pull-right">
            
              
  <li><a href="../_sources/formats/base_classes.rst.txt"
	  rel="nofollow"><i class="icon-file"></i> Source</a></li>
            
          
            
<form class="navbar-search pull-right" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
          </ul>
        </div>
      </div>
    </div>
  </div>

<div class="container content">
   
  <div class="section" id="base-classes">
<span id="id1"></span><h1>Base classes<a class="headerlink" href="#base-classes" title="Permalink to this headline">¶</a></h1>
<p>NOTE: This page is mostly useful for <a class="reference internal" href="../developers/developers.html"><span class="doc">developers</span></a> as it describes some programming detail of the
<a class="reference internal" href="index.html"><span class="doc">toolkit</span></a>.</p>
<p>For the implementation of the different storage classes that the toolkit
supports, we want to define a set of base classes to form a common API for all
formats. This will simplify implementation of new storage formats, and enable
easy integration into external tools, such as Pootle. It will also mean less
duplication of code in similar storage formats.</p>
<p>These ideas explained here should be seen as drafts only.</p>
<div class="section" id="requirements">
<span id="base-classes-requirements"></span><h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>The base classes should be rich enough in functionality to enable users of the
base classes to have access to all or most of the features that are available
in the formats. In particular, the following are considered requirements:</p>
<ul class="simple">
<li><p>Seamless and hidden handling of escaping, quoting and character sets</p></li>
<li><p>Parsing a file when given a file name or file contents (whole file in a
string)</p></li>
<li><p>Writing a file to disk</p></li>
<li><p>Getting and setting source and target languages</p></li>
<li><p>Accessing units, and determining if they are translatable, translated, a
unique identifier for the unit in the file, etc.</p></li>
<li><p>Support for plural units that can vary between different languages (as the PO
format allows with msgid_plural, etc.)</p></li>
</ul>
<p>Other possibilities:</p>
<ul class="simple">
<li><p>Support for variable number of languages in the format. Examples: .txt and
.properties support one language, PO supports two, <a class="reference internal" href="tmx.html"><span class="doc">TMX</span></a> supports many.</p></li>
<li><p>Support for “multifiles”, in other words a file that contain other entities
that corresponds to files in other formats. Examples: ZIP and
<a class="reference internal" href="xliff.html"><span class="doc">XLIFF</span></a>. In reality this is only used by some of the converters. This
isn’t present in the base class yet.</p></li>
</ul>
<p>All these do not mean that all formats must support al these features, but in
the formats that do support these features, it must be accessible through the
base class, and it must be possible to interrogate the storage format through
the base class to know which features it supports.</p>
</div>
<div class="section" id="the-classes">
<span id="base-classes-the-classes"></span><h2>The classes<a class="headerlink" href="#the-classes" title="Permalink to this headline">¶</a></h2>
<p>A file contains a number of translation units, and possibly a header. Each
translation unit contains one or more strings corresponding to each of the
languages represented in that unit.</p>
<div class="section" id="message-string-multistring">
<span id="base-classes-message-string-multistring"></span><h3>Message/string (multistring)<a class="headerlink" href="#message-string-multistring" title="Permalink to this headline">¶</a></h3>
<p>This class represents a single conceptual string in a single language. It must
know its own requirements for escaping and implement it internally. Escaped
versions are only used for internal representation and only exposed for file
creation and testing (unit tests, for example).</p>
<p>Note that when storing different plural forms of the same string, they should
be stored in this class. The main object is the singular string, and all of the
string forms can be accessed in a list at x.strings. Most of the time the
object can be dealt with as a single string, only when it is necessary to deal
with plural forms do the extra strings have to be taken into account.</p>
<p>Any string from a plural unit must be a multistring.</p>
</div>
<div class="section" id="translation-unit">
<span id="base-classes-translation-unit"></span><h3>Translation unit<a class="headerlink" href="#translation-unit" title="Permalink to this headline">¶</a></h3>
<p>This class represents a unit of one or several related messages/strings. In
most formats the contained strings will be translations of some original
message/string. It must associate a language value with each message/string. It
must know how to join all contained messages/strings to compile a valid
representation. For formats that support at least two languages, the first two
languages will serve as “source” and “target” languages for the common case of
translating from one language into another language.</p>
<p>Some future ideas:</p>
<p>As the number of languages can be seen as one “dimension” of the translation
unit, plurality can be seen as a second dimension. A format can thus be
classified according to the dimensionality that it supports, as follows:</p>
<ul class="simple">
<li><p>.properties files supports one language and no concept of plurals. This
include most document types, such as .txt, HTML and OpenDocument formats.</p></li>
<li><p>Old style PO files supported two languages and no plurals.</p></li>
<li><p>New style PO files support two languages and any number of plurals as
required by the target language. The plural forms are stored in the original
or target strings, as extra forms of the string (See message/string class
above).</p></li>
<li><p>TMX files support any number of languages, but has no concept of plurality.</p></li>
</ul>
<p>Comments/notes are supported in this class. Quality or status information
(fuzzy, last-changed-by) should be stored. TODO: see if this should be on unit
level or language level.</p>
</div>
<div class="section" id="store">
<span id="base-classes-store"></span><h3>Store<a class="headerlink" href="#store" title="Permalink to this headline">¶</a></h3>
<p>This class represents a whole collection of translation units, usually stored
in a single file. It supports the concept of a header, and possibly comments at
file level. A file will not necessarily be contained alone in single file on
disc. See “multifile” below.</p>
</div>
<div class="section" id="multifile">
<span id="base-classes-multifile"></span><h3>Multifile<a class="headerlink" href="#multifile" title="Permalink to this headline">¶</a></h3>
<p>This abstraction is only used by a few converters.</p>
<p>This class represents a storage format that contains other files or file like
objects. Examples include ZIP, XLIFF, and OpenOffice SDF files. It must
give access to the contained files, and possibly give access to the translation
units contained in those files, as if they are contained natively.</p>
</div>
</div>
</div>
<div class="section" id="additional-notes">
<span id="base-classes-additional-notes"></span><h1>Additional Notes<a class="headerlink" href="#additional-notes" title="Permalink to this headline">¶</a></h1>
<p>Dwayne and I (Andreas) discussed cleaning up the storage base class.  A lot of
what we discussed is related to the above.  A quick summary:</p>
<ul>
<li><p>Implement a new base class.</p>
<ul class="simple">
<li><p>Flesh out the API, clean and clear definitions.</p></li>
<li><p>Document the API.</p></li>
</ul>
</li>
<li><p>We need to discuss the class hierarchy, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">base</span>
     <span class="o">--</span> <span class="n">po</span>
     <span class="o">--</span> <span class="n">text</span>
     <span class="o">--</span> <span class="n">xml</span>
            <span class="o">--</span> <span class="n">xhtml</span>
            <span class="o">--</span> <span class="n">lisa</span>
                    <span class="o">--</span> <span class="n">xliff</span>
                    <span class="o">--</span> <span class="n">tmx</span>
                    <span class="o">--</span> <span class="n">tbx</span>
</pre></div>
</div>
</li>
<li><p>Clean up converters.</p>
<ul>
<li><p>Parsing of file content needs to happen only in the storage implementation
of each filetype/storage type. Currently parsing happens all over the
place.</p></li>
<li><p>Currently there are separate conversion programs for each type and
direction to convert to, e.g. po2xliff and xliff2po (24 commands with lots
of duplicate code in them). Ideally conversion should be as simple as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">po_store</span> <span class="o">=</span> <span class="n">POStore</span><span class="p">(</span><span class="n">filecontent</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">po_store</span><span class="p">))</span>
<span class="go">msgid &quot;bleep&quot;</span>
<span class="go">msgstr &quot;blorp&quot;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">xliff_store</span> <span class="o">=</span> <span class="n">XliffStore</span><span class="p">(</span><span class="n">po_store</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">xliff_store</span><span class="p">))</span>
<span class="go">&lt;xliff&gt;</span>
<span class="go">  &lt;file&gt;</span>
<span class="go">    &lt;trans-unit&gt;</span>
<span class="go">      &lt;source&gt;bleep&lt;/source&gt;</span>
<span class="go">      &lt;target&gt;blorp&lt;/target&gt;</span>
<span class="go">    &lt;/trans-unit&gt;</span>
<span class="go">  &lt;/file&gt;</span>
<span class="go">&lt;/xliff&gt;</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<p>Note that the xliffstore is being instantiated using the postore object.  This
works because all the data in any translation store object is accessible via
the same well-defined base API.  A concept class implementing the above code
snippet has already been written.</p>
<ul class="simple">
<li><p>Move certain options into their respective storage classes.</p>
<ul>
<li><p>e.g. the <code class="docutils literal notranslate"><span class="pre">--duplicates</span></code> option can move into po.py</p></li>
</ul>
</li>
<li><p>Store the meta data for a storage object.</p>
<ul>
<li><p>Can be implemented as separate sqlite file that accompanies the real file.</p></li>
<li><p>Features not directly supported by a file format can be stored in the
metadata file.</p></li>
</ul>
</li>
<li><p>A storage object should know all information pertaining to itself.</p>
<ul>
<li><p>e.g. “am I monolingual?”</p></li>
</ul>
</li>
<li><p>We should discuss how to make an object aware that it is monolingual,
bilingual or multilingual.</p>
<ul>
<li><p>Maybe through mixin-classes?</p></li>
<li><p>How will the behaviour of a monolingual store differ from a bilingual
store?</p></li>
</ul>
</li>
</ul>
</div>


</div>
<hr>

<footer class="footer">
  <div class="container">
    <p class="pull-right"><a href="#">Back to top ↑</a></p>
    <ul class="unstyled muted">
      <li><small>
        &copy; 2002-2021, Translate.<br/>
      </small></li>
      <li><small>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 3.5.1.
      </small></li>
    </ul>
  </div>
</footer>
  </body>
</html>