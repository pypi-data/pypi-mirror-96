

<!doctype html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The sqlobject-admin Tool &#8212; SQLObject 3.9.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Inheritance" href="Inheritance.html" />
    <link rel="prev" title="SelectResults: Using Queries" href="SelectResults.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Inheritance.html" title="Inheritance"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="SelectResults.html" title="SelectResults: Using Queries"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SQLObject 3.9.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The sqlobject-admin Tool</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-sqlobject-admin-tool">
<h1><a class="toc-backref" href="#id1">The sqlobject-admin Tool</a><a class="headerlink" href="#the-sqlobject-admin-tool" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">author</dt>
<dd class="field-odd"><p>Ian Bicking &lt;<a class="reference external" href="mailto:ianb&#37;&#52;&#48;colorstudy&#46;com">ianb<span>&#64;</span>colorstudy<span>&#46;</span>com</a>&gt;</p>
</dd>
<dt class="field-even">revision</dt>
<dd class="field-even"><p>$Rev$</p>
</dd>
<dt class="field-odd">date</dt>
<dd class="field-odd"><p>$LastChangedDate$</p>
</dd>
</dl>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#the-sqlobject-admin-tool" id="id1">The sqlobject-admin Tool</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#common-options" id="id3">Common Options</a></p></li>
<li><p><a class="reference internal" href="#simple-commands" id="id4">Simple Commands</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-create-command" id="id5">The <code class="docutils literal notranslate"><span class="pre">create</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-sql-command" id="id6">The <code class="docutils literal notranslate"><span class="pre">sql</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-drop-command" id="id7">The <code class="docutils literal notranslate"><span class="pre">drop</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-execute-command" id="id8">The <code class="docutils literal notranslate"><span class="pre">execute</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-list-command" id="id9">The <code class="docutils literal notranslate"><span class="pre">list</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-status-command" id="id10">The <code class="docutils literal notranslate"><span class="pre">status</span></code> Command</a></p>
<ul>
<li><p><a class="reference internal" href="#versioning-upgrading" id="id11">Versioning &amp; Upgrading</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#basic-usage" id="id12">Basic Usage</a></p></li>
<li><p><a class="reference internal" href="#the-record-command" id="id13">The <code class="docutils literal notranslate"><span class="pre">record</span></code> Command</a></p></li>
<li><p><a class="reference internal" href="#the-upgrade-command" id="id14">The <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> Command</a></p>
<ul>
<li><p><a class="reference internal" href="#future" id="id15">Future</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This document isn’t entirely accurate; some of what it describes
are the intended features of the tool, not the actual features.</p>
<p>Particularly inaccurate is how modules and classes are found.</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sqlobject-admin</span></code> tool included with SQLObject allows you to
manage your database as defined with SQLObject classes.</p>
<p>Some of the features include creating tables, checking the status of
the database, recording a version of a schema, and updating the
database to match the version of the schema in your code.</p>
<p>To see a list of commands run <code class="docutils literal notranslate"><span class="pre">sqlobject-admin</span> <span class="pre">help</span></code>.  Each
sub-command has <code class="docutils literal notranslate"><span class="pre">-h</span></code> option which explains the details of that
command.</p>
<div class="section" id="common-options">
<h3><a class="toc-backref" href="#id3">Common Options</a><a class="headerlink" href="#common-options" title="Permalink to this headline">¶</a></h3>
<p>Many of the commands share some common options, mostly for finding the
database and classes.</p>
<p><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">CONNECTION</span></code> or <code class="docutils literal notranslate"><span class="pre">--connection=CONNECTION</span></code>:</p>
<blockquote>
<div><p>This takes an argument, the connection string for the database.
This overrides any connection the classes have (if they are
hardwired to a connection).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">FILENAME</span></code> or <code class="docutils literal notranslate"><span class="pre">--config-file=FILENAME</span></code>:</p>
<blockquote>
<div><p>This is a configuration file from which to get the connection.
This configuration file should be a Python-syntax file that
defines a global variable <code class="docutils literal notranslate"><span class="pre">database</span></code>, which is the connection
string for the database.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">MODULE</span></code> or <code class="docutils literal notranslate"><span class="pre">--module=MODULE</span></code>:</p>
<blockquote>
<div><p>A module to look in for classes.  <code class="docutils literal notranslate"><span class="pre">MODULE</span></code> is something like
<code class="docutils literal notranslate"><span class="pre">myapp.amodule</span></code>.  Remember to set your <code class="docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code> if the
module can’t be imported.  You can provide this argument multiple
times.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">PACKAGE</span></code> or <code class="docutils literal notranslate"><span class="pre">--package=PACKAGE</span></code>:</p>
<blockquote>
<div><p>A package to look in.  This looks in all the modules in this class
and subclasses for SQLObject classes.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--class=CLASSMATCH</span></code>:</p>
<blockquote>
<div><p>This <em>restricts</em> the classes found to the matching classes.  You
may use wildcards.  You can provide multiple <code class="docutils literal notranslate"><span class="pre">--class</span></code>
arguments, and if any pattern matches the class will be included.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--egg=EGG_SPEC</span></code>:</p>
<blockquote>
<div><p>This is an <a class="reference external" href="http://peak.telecommunity.com/DevCenter/PythonEggs">Egg</a> description
that should be loaded.  So if you give <code class="docutils literal notranslate"><span class="pre">--egg=ProjectName</span></code> it’ll
load that egg, and look in <code class="docutils literal notranslate"><span class="pre">ProjectName.egg-info/sqlobject.txt</span></code>
for some settings (like <code class="docutils literal notranslate"><span class="pre">db_module</span></code> and <code class="docutils literal notranslate"><span class="pre">history_dir</span></code>).</p>
</div></blockquote>
<p>When finding SQLObject classes, we look in the modules for classes
that belong to the module – so if you import a class from another
module it won’t be “matched”.  You have to indicate its original
module.</p>
<p>If classes have to be handled in a specific order, create a
<code class="docutils literal notranslate"><span class="pre">soClasses</span></code> global variable that holds a list of the classes.  This
overrides the module restrictions.  This is important in databases
with referential integrity, where dependent tables can’t be created
before the tables they depend on.</p>
</div>
<div class="section" id="simple-commands">
<h3><a class="toc-backref" href="#id4">Simple Commands</a><a class="headerlink" href="#simple-commands" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="the-create-command">
<h2><a class="toc-backref" href="#id5">The <code class="docutils literal notranslate"><span class="pre">create</span></code> Command</a><a class="headerlink" href="#the-create-command" title="Permalink to this headline">¶</a></h2>
<p>This finds the tables and creates them.  Any tables that exist are
simply skipped.</p>
<p>It also collects data from sqlmeta.createSQL (added in svn trunk) and
runs the queries after table creation. createSQL can be a string with
a single SQL command, a list of SQL commands, or a dictionary with
keys that are dbNames and values that are either single SQL command
string or a list of SQL commands. An example follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTable</span><span class="p">(</span><span class="n">SQLObject</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">sqlmeta</span><span class="p">:</span>
        <span class="n">createSQL</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;postgres&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;ALTER TABLE my_table ADD CHECK(my_field != &#39;&#39;);&quot;</span><span class="p">,</span>
            <span class="p">]}</span>
    <span class="n">myField</span> <span class="o">=</span> <span class="n">StringCol</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="the-sql-command">
<h2><a class="toc-backref" href="#id6">The <code class="docutils literal notranslate"><span class="pre">sql</span></code> Command</a><a class="headerlink" href="#the-sql-command" title="Permalink to this headline">¶</a></h2>
<p>This shows the SQL to create all the tables.</p>
</div>
<div class="section" id="the-drop-command">
<h2><a class="toc-backref" href="#id7">The <code class="docutils literal notranslate"><span class="pre">drop</span></code> Command</a><a class="headerlink" href="#the-drop-command" title="Permalink to this headline">¶</a></h2>
<p>Drops tables!  Missing tables are skipped.</p>
</div>
<div class="section" id="the-execute-command">
<h2><a class="toc-backref" href="#id8">The <code class="docutils literal notranslate"><span class="pre">execute</span></code> Command</a><a class="headerlink" href="#the-execute-command" title="Permalink to this headline">¶</a></h2>
<p>This executes an arbitrary SQL expression.  This is mostly useful if
you want to run a query against a database described by a SQLObject
connection string.  Use <code class="docutils literal notranslate"><span class="pre">--stdin</span></code> if you want to pipe commands in;
otherwise you give the commands as arguments.</p>
</div>
<div class="section" id="the-list-command">
<h2><a class="toc-backref" href="#id9">The <code class="docutils literal notranslate"><span class="pre">list</span></code> Command</a><a class="headerlink" href="#the-list-command" title="Permalink to this headline">¶</a></h2>
<p>Lists out all the classes found.  This can help you figure out
what classes you are dealing with, and if there’s any missing that you
expected.</p>
</div>
<div class="section" id="the-status-command">
<h2><a class="toc-backref" href="#id10">The <code class="docutils literal notranslate"><span class="pre">status</span></code> Command</a><a class="headerlink" href="#the-status-command" title="Permalink to this headline">¶</a></h2>
<p>This shows if tables are present in the database.  If possible (it
depends on the database) it will also show if the tables are missing
any columns, or have any extra columns, when compared to the table the
SQLObject class describes.  It doesn’t check column types, indexes, or
constraints.  This feature may be added in the future.</p>
<div class="section" id="versioning-upgrading">
<h3><a class="toc-backref" href="#id11">Versioning &amp; Upgrading</a><a class="headerlink" href="#versioning-upgrading" title="Permalink to this headline">¶</a></h3>
<p>There’s two commands related to storing the schema and upgrading the
database: <code class="docutils literal notranslate"><span class="pre">record</span></code> and <code class="docutils literal notranslate"><span class="pre">upgrade</span></code>.</p>
<p>The idea is that you record each iteration of your schema, and this
gets a version number.  Something like <code class="docutils literal notranslate"><span class="pre">2003-05-04a</span></code>.  If you are
using source control you’ll check all versions into your repository;
you don’t overwrite one with the next.</p>
<p>In addition to the on-disk record of the different schemas you have
gone through, the database itself contains a record of what version it
is at.  By having all the versions available at once, we can upgrade
from any version.  But more on that <a class="reference external" href="the-upgrade-command">later</a></p>
</div>
</div>
<div class="section" id="basic-usage">
<h2><a class="toc-backref" href="#id12">Basic Usage</a><a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h2>
<p>Here’s a quick summary of how you use these commands:</p>
<ol class="arabic simple">
<li><p>In project where you’ve never used <code class="docutils literal notranslate"><span class="pre">sqlobject-admin</span></code> before, you
run <code class="docutils literal notranslate"><span class="pre">sqlobject-admin</span> <span class="pre">record</span> <span class="pre">--output-dir=sqlobject-history</span></code>.
If your active database is up-to-date with the code, then the tool
will add a <code class="docutils literal notranslate"><span class="pre">sqlobject_db_version</span></code> table to the database with the
current version.</p></li>
<li><p>Now, make some updates to your code.  Don’t update the database!
(You could, but for now it’s more fun if you don’t.)</p></li>
<li><p>Run <code class="docutils literal notranslate"><span class="pre">sqlobject-admin</span> <span class="pre">record</span> <span class="pre">--edit</span></code>.  A new version will be
created, and an editor will be opened up.</p></li>
</ol>
</div>
<div class="section" id="the-record-command">
<h2><a class="toc-backref" href="#id13">The <code class="docutils literal notranslate"><span class="pre">record</span></code> Command</a><a class="headerlink" href="#the-record-command" title="Permalink to this headline">¶</a></h2>
<p>Record will take the SQL <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> statements for your tables, and
output them in new version.  It creates the version by using the
ISO-formatted date (YYYY-MM-DD) and a suffix to make it unique.  It
puts each table in its own file.</p>
<p>This normally doesn’t touch the database at all – it only records the
schema as defined in your code, regardless of the database.  In fact,
I recommend calling <code class="docutils literal notranslate"><span class="pre">record</span></code> <em>before</em> you update your database.</p>
</div>
<div class="section" id="the-upgrade-command">
<h2><a class="toc-backref" href="#id14">The <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> Command</a><a class="headerlink" href="#the-upgrade-command" title="Permalink to this headline">¶</a></h2>
<div class="section" id="future">
<h3><a class="toc-backref" href="#id15">Future</a><a class="headerlink" href="#future" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Get <code class="docutils literal notranslate"><span class="pre">record</span></code> to do <code class="docutils literal notranslate"><span class="pre">svn</span> <span class="pre">cp</span></code> when creating a new version, then
write over those files; this way the version control system will
have nice diffs.</p></li>
<li><p>An option to <code class="docutils literal notranslate"><span class="pre">record</span></code> the SQL for multiple database backends at
once (now only the active backend is recorded).</p></li>
<li><p>An option to upgrade databases with Python scripts instead of SQL
commands.  Or a little of both.</p></li>
<li><p>Review all the verbosity, maybe add logging, review simulation.</p></li>
<li><p>Generate simple <code class="docutils literal notranslate"><span class="pre">ALTER</span></code> statements for upgrade scripts, to give
people something to work with.  Maybe.</p></li>
<li><p>A command to trim versions, by merging upgrade scripts.</p></li>
</ul>
<a class="reference external image-reference" href="https://sourceforge.net/projects/sqlobject"><img alt="Get SQLObject at SourceForge.net. Fast, secure and Free Open Source software downloads" class="noborder align-center" src="https://sourceforge.net/sflogo.php?group_id=74338&amp;type=10" style="width: 80px; height: 15px;" /></a>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The sqlobject-admin Tool</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#common-options">Common Options</a></li>
<li><a class="reference internal" href="#simple-commands">Simple Commands</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-create-command">The <code class="docutils literal notranslate"><span class="pre">create</span></code> Command</a></li>
<li><a class="reference internal" href="#the-sql-command">The <code class="docutils literal notranslate"><span class="pre">sql</span></code> Command</a></li>
<li><a class="reference internal" href="#the-drop-command">The <code class="docutils literal notranslate"><span class="pre">drop</span></code> Command</a></li>
<li><a class="reference internal" href="#the-execute-command">The <code class="docutils literal notranslate"><span class="pre">execute</span></code> Command</a></li>
<li><a class="reference internal" href="#the-list-command">The <code class="docutils literal notranslate"><span class="pre">list</span></code> Command</a></li>
<li><a class="reference internal" href="#the-status-command">The <code class="docutils literal notranslate"><span class="pre">status</span></code> Command</a><ul>
<li><a class="reference internal" href="#versioning-upgrading">Versioning &amp; Upgrading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#the-record-command">The <code class="docutils literal notranslate"><span class="pre">record</span></code> Command</a></li>
<li><a class="reference internal" href="#the-upgrade-command">The <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> Command</a><ul>
<li><a class="reference internal" href="#future">Future</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="SelectResults.html"
                        title="previous chapter">SelectResults: Using Queries</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Inheritance.html"
                        title="next chapter">Inheritance</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sqlobject-admin.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Inheritance.html" title="Inheritance"
             >next</a> |</li>
        <li class="right" >
          <a href="SelectResults.html" title="SelectResults: Using Queries"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SQLObject 3.9.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The sqlobject-admin Tool</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2004-2021, Ian Bicking and contributors.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.1.
    </div>
  </body>
</html>